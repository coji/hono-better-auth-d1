# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

### Core Development

- `pnpm dev` - Start both API server and client development servers concurrently
- `pnpm dev:api` - Start only the Hono API server via Wrangler
- `pnpm dev:client` - Start only the React Router client development server
- `pnpm build` - Build the React Router client application
- `pnpm deploy` - Deploy to Cloudflare Workers with minification

### Code Quality

- `pnpm validate` - Run full validation suite (format, lint, typecheck)
- `pnpm lint` - Run Biome linter
- `pnpm format` - Check code formatting with Prettier
- `pnpm typecheck` - Run TypeScript type checking
- `pnpm typegen` - Generate Cloudflare Worker types

### Database Operations

- `pnpm db:generate` - Generate Drizzle migration files
- `pnpm db:migrate` - Apply migrations to local D1 database
- `pnpm db:migrate:prod` - Apply migrations to production D1 database

### Authentication Schema

- `pnpm auth:generate` - Generate Better Auth schema from migration dummy script

## Architecture Overview

This is a full-stack authentication application built with:

### Backend (Hono + Better Auth + Cloudflare D1)

- **Entry Point**: `api/index.ts` - Main Hono application with environment-based CORS configuration
- **Auth Configuration**: `api/lib/auth.config.ts` - Better Auth options with dynamic trustedOrigins from environment variables
- **Auth Instance**: `api/lib/auth.ts` - Better Auth instance with Drizzle adapter for SQLite
- **Database**: `api/db/` - Drizzle ORM setup with auth schema (`schema-auth.ts`) and main schema (`schema.ts`)
- **API Routes**: `api/routes/auth.ts` - Authentication endpoints mounted at `/api/auth`

### Frontend (React Router v7 + Conform + Zod)

- **Configuration**: React Router in SPA mode with prerendering enabled
- **Auth Client**: `app/lib/auth-client.ts` - Better Auth React client
- **Form Validation**: Uses Conform with Zod for type-safe form handling and validation
- **Routes**: File-based routing with sign-in (`/signin`) and sign-up (`/signup`) pages
- **Styling**: Tailwind CSS v4 integrated with custom UI components

### Frontend Components & Routes

- **Home Page**: `app/routes/_index/route.tsx` - Landing page with auth status
- **Sign In**: `app/routes/signin/route.tsx` - Email/password sign-in form with Conform validation
- **Sign Up**: `app/routes/signup/route.tsx` - User registration form with name, email, password confirmation
- **UI Components**: `app/components/ui/` - Reusable Radix UI components (Button, Card, Input, Label)
- **Auth Hook**: `app/hooks/use-session.ts` - Session management utilities

### Form Validation with Conform + Zod

- **Sign In Schema**: Email and password validation (6+ characters)
- **Sign Up Schema**: Name, email, password (8+ characters), and confirmation validation
- **Real-time Validation**: Client-side validation with server-side error handling
- **Type Safety**: Full TypeScript integration with Zod constraints

### Database Schema

- Uses Drizzle ORM with SQLite (Cloudflare D1)
- Auth tables generated by Better Auth (user, session, account, verification)
- Schema split between `schema-auth.ts` (auth tables) and `schema.ts` (app tables)

### Environment Configuration

- **Cloudflare Workers**: Uses `wrangler.jsonc` vars for environment-specific settings
- **Environment Variables**: `CLIENT_ORIGIN` and `BETTER_AUTH_URL` configured via wrangler vars
- **Node.js Compatibility**: Uses `nodejs_compat_populate_process_env` flag for `process.env` access
- **Dynamic CORS**: Origins configured based on `CLIENT_ORIGIN` environment variable
- **Dynamic Auth**: Better Auth `trustedOrigins` configured from environment variables

### Key Integration Points

- Hono app uses `AuthType` variables for type-safe auth context
- CORS dynamically configured based on environment variables
- Cloudflare D1 database binding named "DB" in wrangler.jsonc
- Better Auth uses Drizzle adapter for database operations
- React Router client-side routing with auth redirects

### Environment Setup

- Uses pnpm workspace configuration
- Cloudflare Workers with Node.js compatibility flags (`nodejs_compat`, `nodejs_compat_populate_process_env`)
- Environment variables managed via `wrangler.jsonc` vars for Workers and `.env` for client-side
- TypeScript configuration split for different environments (cloudflare, node)

### Environment Variables

#### Cloudflare Workers (wrangler.jsonc)
- `CLIENT_ORIGIN` - Allowed origins for CORS and Better Auth trustedOrigins
- `BETTER_AUTH_URL` - Auth server URL for Better Auth configuration

#### Client-side (.env)
- `VITE_API_URL` - API endpoint URL for client-side auth calls
- `BETTER_AUTH_SECRET` - Better Auth secret key
- `DATABASE_URL` - Database connection string

# important-instruction-reminders

Do what has been asked; nothing more, nothing less.
NEVER create files unless they're absolutely necessary for achieving your goal.
ALWAYS prefer editing an existing file to creating a new one.
NEVER proactively create documentation files (\*.md) or README files. Only create documentation files if explicitly requested by the User.
